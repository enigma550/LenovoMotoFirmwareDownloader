@if (plan(); as activePlan) {
  <div
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4"
    (click)="onBackdropClick()"
  >
    <div
      class="w-full max-w-3xl rounded-2xl border p-5 shadow-xl"
      [class.border-slate-200]="!isDark()"
      [class.bg-white]="!isDark()"
      [class.border-slate-700]="isDark()"
      [class.bg-slate-900]="isDark()"
      (click)="onDialogClick($event)"
    >
      <h4
        class="text-base font-bold"
        [class.text-slate-900]="!isDark()"
        [class.text-slate-100]="isDark()"
      >
        Rescue Lite Dry Run Command Plan
      </h4>
      <p class="mt-2 text-xs" [class.text-slate-600]="!isDark()" [class.text-slate-300]="isDark()">
        {{ activePlan.romName }} | source={{ activePlan.commandSource }} | data reset:
        {{ activePlan.dataReset === 'yes' ? 'Yes' : 'No' }} | transport:
        {{ flashTransportLabel(activePlan.flashTransport) }}
        @if (activePlan.flashTransport === 'qdl') {
          | storage: {{ activePlan.qdlStorage.toUpperCase() }}
          @if (activePlan.qdlSerial) {
            | serial: {{ activePlan.qdlSerial }}
          }
        }
      </p>

      @if (activePlan.localFilePath) {
        <p
          class="mt-1 break-all text-xs"
          [class.text-slate-500]="!isDark()"
          [class.text-slate-400]="isDark()"
        >
          {{ activePlan.localFilePath }}
        </p>
      }

      <div
        class="mt-3 max-h-[55vh] overflow-auto rounded-xl border p-3 font-mono text-xs"
        [class.border-slate-200]="!isDark()"
        [class.bg-slate-50]="!isDark()"
        [class.border-slate-700]="isDark()"
        [class.bg-slate-800]="isDark()"
        [class.text-slate-800]="!isDark()"
        [class.text-slate-100]="isDark()"
      >
        @for (command of activePlan.commands; track $index) {
          <p class="break-all">{{ command }}</p>
        }
      </div>

      <div class="mt-5 flex items-center justify-end gap-2">
        <app-rescue-dialog-button label="Close" variant="primary" (clicked)="onBackdropClick()" />
      </div>
    </div>
  </div>
}

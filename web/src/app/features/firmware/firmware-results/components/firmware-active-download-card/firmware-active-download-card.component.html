@if (download(); as activeDownload) {
  <article
    class="rounded-2xl border p-4"
    [class.border-slate-200]="!isDark()"
    [class.bg-slate-50]="!isDark()"
    [class.border-slate-700]="isDark()"
    [class.bg-slate-800]="isDark()"
  >
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div class="flex items-center gap-2">
        <span
          class="rounded-lg border px-2 py-1 text-xs"
          [class.border-sky-300]="!isDark()"
          [class.text-sky-700]="!isDark()"
          [class.border-sky-700]="isDark()"
          [class.text-sky-300]="isDark()"
        >
          {{ actionLabel(activeDownload) }}
        </span>
        <span
          class="rounded-lg border px-2 py-1 text-xs"
          [class.border-slate-300]="!isDark()"
          [class.text-slate-600]="!isDark()"
          [class.border-slate-600]="isDark()"
          [class.text-slate-300]="isDark()"
        >
          {{ activeDownload.status }}
        </span>
        @if (isRescueLite(activeDownload) && isRecipeGuided(activeDownload)) {
          <span
            class="rounded-lg border px-2 py-1 text-xs"
            [class.border-emerald-300]="!isDark()"
            [class.text-emerald-700]="!isDark()"
            [class.border-emerald-700]="isDark()"
            [class.text-emerald-300]="isDark()"
          >
            Recipe-guided
          </span>
        }
      </div>
      <div class="flex items-center gap-2">
        @if (activeDownload.status === 'downloading') {
          <app-ui-action-button
            label="Pause"
            variant="warning"
            appearance="solid"
            [isDark]="isDark()"
            [disabled]="isCanceling()"
            (clicked)="onPause()"
          />
        } @else if (activeDownload.status === 'paused') {
          <app-ui-action-button
            label="Resume"
            variant="success"
            appearance="solid"
            [isDark]="isDark()"
            [disabled]="isCanceling()"
            (clicked)="onResume()"
          />
        }

        <app-ui-action-button
          [label]="cancelButtonLabel()"
          variant="danger"
          appearance="solid"
          [isDark]="isDark()"
          [disabled]="isCanceling()"
          (clicked)="onCancel()"
        />
        <app-ui-action-button
          label="Clear"
          variant="neutral"
          appearance="outline"
          [isDark]="isDark()"
          (clicked)="onClear()"
        />
      </div>
    </div>

    <p class="mt-2 text-xs" [class.text-slate-600]="!isDark()" [class.text-slate-300]="isDark()">
      {{ activeDownload.romName }}
    </p>
    @if (isRescueLite(activeDownload)) {
      <p class="mt-1 text-xs" [class.text-slate-500]="!isDark()" [class.text-slate-400]="isDark()">
        Execution: {{ rescueExecutionLabel() }} | Data reset:
        {{ dataResetLabel(activeDownload.dataReset) }} | Transport:
        {{ flashTransportLabel(activeDownload.flashTransport) }}
      </p>
      @if (rescueStepText(activeDownload)) {
        <p
          class="mt-1 break-all text-xs"
          [class.text-slate-500]="!isDark()"
          [class.text-slate-400]="isDark()"
        >
          {{ rescueStepText(activeDownload) }}
        </p>
      }
    }

    <app-progress-bar class="mt-3" [percent]="downloadPercent() || 0" [isDark]="isDark()" />

    @if (activeDownload.savePath) {
      <p
        class="mt-1 break-all text-xs"
        [class.text-slate-500]="!isDark()"
        [class.text-slate-400]="isDark()"
      >
        Saved to: {{ activeDownload.savePath }}
      </p>
    }
  </article>
}

@if (download(); as activeDownload) {
  <article
    class="rounded-2xl border p-4"
    [class.border-slate-200]="!isDark()"
    [class.bg-slate-50]="!isDark()"
    [class.border-slate-700]="isDark()"
    [class.bg-slate-800]="isDark()"
  >
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div class="flex items-center gap-2">
        <span
          class="rounded-lg border px-2 py-1 text-xs"
          [class.border-sky-300]="!isDark()"
          [class.text-sky-700]="!isDark()"
          [class.border-sky-700]="isDark()"
          [class.text-sky-300]="isDark()"
        >
          {{ actionLabel(activeDownload) }}
        </span>
        <span
          class="rounded-lg border px-2 py-1 text-xs"
          [class.border-slate-300]="!isDark()"
          [class.text-slate-600]="!isDark()"
          [class.border-slate-600]="isDark()"
          [class.text-slate-300]="isDark()"
        >
          {{ activeDownload.status }}
        </span>
        @if (isRescueLite(activeDownload) && isRecipeGuided(activeDownload)) {
          <span
            class="rounded-lg border px-2 py-1 text-xs"
            [class.border-emerald-300]="!isDark()"
            [class.text-emerald-700]="!isDark()"
            [class.border-emerald-700]="isDark()"
            [class.text-emerald-300]="isDark()"
          >
            Recipe-guided
          </span>
        }
      </div>
      <div class="flex items-center gap-2">
        @if (activeDownload.status === 'downloading') {
          <button
            class="rounded-lg bg-amber-600 px-2 py-1 text-xs font-semibold text-white transition hover:bg-amber-500 disabled:opacity-60"
            type="button"
            [disabled]="isCanceling()"
            (click)="onPause()"
          >
            Pause
          </button>
        } @else if (activeDownload.status === 'paused') {
          <button
            class="rounded-lg bg-emerald-600 px-2 py-1 text-xs font-semibold text-white transition hover:bg-emerald-500 disabled:opacity-60"
            type="button"
            [disabled]="isCanceling()"
            (click)="onResume()"
          >
            Resume
          </button>
        }

        <button
          class="rounded-lg bg-rose-700 px-2 py-1 text-xs font-semibold text-white transition hover:bg-rose-600 disabled:opacity-60"
          type="button"
          [disabled]="isCanceling()"
          (click)="onCancel()"
        >
          {{ cancelButtonLabel() }}
        </button>
        <button
          class="rounded-lg border px-2 py-1 text-xs transition"
          [class.border-slate-300]="!isDark()"
          [class.text-slate-700]="!isDark()"
          [class.hover:bg-slate-100]="!isDark()"
          [class.border-slate-600]="isDark()"
          [class.text-slate-200]="isDark()"
          [class.hover:bg-slate-700]="isDark()"
          type="button"
          (click)="onClear()"
        >
          Clear
        </button>
      </div>
    </div>

    <p class="mt-2 text-xs" [class.text-slate-600]="!isDark()" [class.text-slate-300]="isDark()">
      {{ activeDownload.romName }}
    </p>
    @if (isRescueLite(activeDownload)) {
      <p class="mt-1 text-xs" [class.text-slate-500]="!isDark()" [class.text-slate-400]="isDark()">
        Execution: {{ rescueExecutionLabel() }} | Data reset:
        {{ dataResetLabel(activeDownload.dataReset) }} | Transport:
        {{ flashTransportLabel(activeDownload.flashTransport) }}
      </p>
      @if (rescueStepText(activeDownload)) {
        <p
          class="mt-1 break-all text-xs"
          [class.text-slate-500]="!isDark()"
          [class.text-slate-400]="isDark()"
        >
          {{ rescueStepText(activeDownload) }}
        </p>
      }
    }

    <app-progress-bar class="mt-3" [percent]="downloadPercent() || 0" [isDark]="isDark()" />

    @if (activeDownload.savePath) {
      <p class="mt-1 break-all text-xs" [class.text-slate-500]="!isDark()" [class.text-slate-400]="isDark()">
        Saved to: {{ activeDownload.savePath }}
      </p>
    }
  </article>
}

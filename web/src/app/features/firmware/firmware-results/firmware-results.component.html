@if (store.firmwareVariants().length > 0) {
  <section
    class="rounded-3xl border p-6"
    [class.border-slate-200]="!store.isDark()"
    [class.bg-white]="!store.isDark()"
    [class.shadow-sm]="!store.isDark()"
    [class.border-slate-700]="store.isDark()"
    [class.bg-slate-900]="store.isDark()"
  >
    <h3
      class="text-lg font-bold"
      [class.text-slate-900]="!store.isDark()"
      [class.text-white]="store.isDark()"
    >
      Firmware variants ({{ store.firmwareVariants().length }})
    </h3>

    @if (activeVariantDownloads().length > 0) {
      <div class="mt-4 grid gap-3">
        @for (download of activeVariantDownloads(); track download.downloadId) {
          <app-firmware-active-download-card [download]="download" [isDark]="store.isDark()" />
        }
      </div>
    }

    <app-rescue-flash-console
      [isDark]="store.isDark()"
      [download]="store.firmwareDownload()"
      [statusText]="store.status()"
      (cancelRequested)="store.cancelDownloadById($event)"
    />

    <div class="mt-3 grid gap-3">
      @for (
        variant of store.firmwareVariants();
        track variant.romUrl + (variant.selectedParameters?.['country'] || '')
      ) {
        <app-firmware-variant-card
          [variant]="variant"
          [isDark]="store.isDark()"
          (rescueRequested)="startRescueLite($event)"
          (rescueDryRunRequested)="startRescueLiteDryRun($event)"
        />
      }
    </div>
  </section>
}

<app-rescue-options-dialog
  [isOpen]="rescueDialogOpen"
  [isDark]="store.isDark()"
  [title]="rescueDialogTitle()"
  [description]="rescueDialogDescription()"
  [targetLabel]="rescueDialogVariant?.romName || ''"
  [dryRun]="rescueDialogDryRun"
  [dataReset]="rescueDialogDataReset"
  [flashTransport]="rescueDialogFlashTransport"
  [qdlStorage]="rescueDialogQdlStorage"
  [qdlSerial]="rescueDialogQdlSerial"
  [qdloaderDriverInstallBusy]="installingWindowsQdloaderDriver"
  [qdloaderDriverInstalled]="windowsQdloaderDriverInstalled"
  [spdDriverInstallBusy]="installingWindowsSpdDriver"
  [spdDriverInstalled]="windowsSpdDriverInstalled"
  [mtkDriverInstallBusy]="installingWindowsMtkDriver"
  [mtkDriverInstalled]="windowsMtkDriverInstalled"
  [showWindowsDriverInstall]="store.appInfo()?.platform === 'win32'"
  (close)="closeRescueDialog()"
  (confirm)="confirmRescueDialog()"
  (installWindowsQdloaderDriver)="installWindowsQdloaderDriver()"
  (installWindowsSpdDriver)="installWindowsSpdDriver()"
  (installWindowsMtkDriver)="installWindowsMtkDriver()"
  (dataResetChange)="setRescueDialogDataReset($event)"
  (flashTransportChange)="setRescueDialogFlashTransport($event)"
  (qdlStorageChange)="setRescueDialogQdlStorage($event)"
  (qdlSerialChange)="setRescueDialogQdlSerial($event)"
/>

<app-rescue-dry-run-plan-dialog
  [isDark]="store.isDark()"
  [plan]="store.rescueDryRunPlanDialog()"
  (close)="closeDryRunPlanDialog()"
/>
